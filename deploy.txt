---
# Source: hologram-welcome-ai-agent-chart/templates/chatbot-deployment.yaml
apiVersion: v1
kind: Secret
metadata:
  name: chatbot-secret
  namespace: 2060-core-dev
type: Opaque
stringData:
  OPENAI_API_KEY: "sk-example-openai-api-key"
  POSTGRES_DB_NAME: "example_db"
  POSTGRES_PASSWORD: "example-db-password"
  POSTGRES_USER: "example_db_user"
---
# Source: hologram-welcome-ai-agent-chart/templates/postgres-deployment.yaml
apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
  namespace: 2060-core-dev
type: Opaque
stringData:
  POSTGRES_DB: "example-db-name"
  POSTGRES_PASSWORD: "example-db-password"
  POSTGRES_USER: "example-db-user"
---
# Source: hologram-welcome-ai-agent-chart/templates/stats-deployment.yaml
apiVersion: v1
kind: Secret
metadata:
  name: stats-secret
  namespace: 2060-core-dev
type: Opaque
stringData:
  QUARKUS_ARTEMIS_A0_PASSWORD: "example-artemis-password"
  QUARKUS_DATASOURCE_PASSWORD: "example-db-password"
---
# Source: hologram-welcome-ai-agent-chart/charts/vs-agent-chart/templates/deployment.yaml
# PersistentVolumeClaim for the VS Agent
# This PVC is used to store the agent's data and configuration
# It is created with a storage class and size defined in the values.yaml file
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: vs-agent-vsa-pv
  namespace: 2060-core-dev
  labels:
    app: vs-agent
  annotations:
    helm.sh/resource-policy: keep
spec:
  accessModes:
    - "ReadWriteOnce"
  storageClassName: csi-cinder-high-speed
  resources:
    requests:
      storage: 1Gi
---
# Source: hologram-welcome-ai-agent-chart/charts/vs-agent-chart/templates/deployment.yaml
# Service deployment for the VS Agent
apiVersion: v1
kind: Service
metadata:
  name: vs-agent
  namespace: 2060-core-dev
  labels:
    app: vs-agent
spec:
  selector:
    app: vs-agent
  ports:
  - name: didcomm
    port: 3001
    targetPort: 3001
    protocol: TCP
  - name: admin
    port: 3000
    targetPort: 3000
    protocol: TCP
  - name: db
    port: 5432
    targetPort: 5432
    protocol: TCP
  - name: redis
    port: 6379
    targetPort: 6379
    protocol: TCP
---
# Source: hologram-welcome-ai-agent-chart/templates/chatbot-deployment.yaml
apiVersion: v1
kind: Service
metadata:
  name: hologram-welcome-ai-agent-chart-chatbot
  namespace: 2060-core-dev
spec:
  type: ClusterIP
  ports:
    - port: 3003
      targetPort: 3003
      name: http
  selector:
    app.kubernetes.io/component: chatbot
    app.kubernetes.io/name: hologram-welcome-ai-agent-chart
    app.kubernetes.io/instance: hologram-welcome-dev
---
# Source: hologram-welcome-ai-agent-chart/templates/postgres-deployment.yaml
apiVersion: v1
kind: Service
metadata:
  name: hologram-welcome-ai-agent-chart-postgres
  namespace: 2060-core-dev
spec:
  type: ClusterIP
  ports:
    - port: 5432
      targetPort: 5432
      name: postgres
  selector:
    app.kubernetes.io/component: postgres
    app.kubernetes.io/name: hologram-welcome-ai-agent-chart
    app.kubernetes.io/instance: hologram-welcome-dev
---
# Source: hologram-welcome-ai-agent-chart/templates/redis-deployment.yaml
apiVersion: v1
kind: Service
metadata:
  name: hologram-welcome-ai-agent-chart-redis
  namespace: 2060-core-dev
spec:
  type: ClusterIP
  ports:
    - port: 6379
      targetPort: 6379
      name: redis
  selector:
    app.kubernetes.io/component: redis
    app.kubernetes.io/name: hologram-welcome-ai-agent-chart
    app.kubernetes.io/instance: hologram-welcome-dev
---
# Source: hologram-welcome-ai-agent-chart/templates/stats-deployment.yaml
apiVersion: v1
kind: Service
metadata:
  name: hologram-welcome-ai-agent-chart-stats
  namespace: 2060-core-dev
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8700
      targetPort: http
  selector:
    app.kubernetes.io/component: stats
    app.kubernetes.io/name: hologram-welcome-ai-agent-chart
    app.kubernetes.io/instance: hologram-welcome-dev
---
# Source: hologram-welcome-ai-agent-chart/charts/vs-agent-chart/templates/deployment.yaml
# StatefulSet description for the VS Agent
# This StatefulSet manages the deployment of the VS Agent service
# It includes the agent container, PostgreSQL database (if enabled), and Redis (if enabled)
# The StatefulSet ensures that the agent service is deployed with a stable identity and persistent storage
# The agent service is configured with environment variables for the agent endpoint, label, invitation image URL, and public DID
# The PostgreSQL database is configured with environment variables for the user and password
# The Redis service is configured with its own container and persistent storage
apiVersion: apps/v1
kind: StatefulSet
metadata:
   name: vs-agent
   namespace: 2060-core-dev
spec:
   serviceName: vs-agent
   replicas: 1
   selector:
      matchLabels:
         app: vs-agent
   template:
      metadata:
         labels:
            app: vs-agent
      spec:
         containers:
         -  name: vs-agent-sa-container
            image: io2060/vs-agent:v1.3.2
            imagePullPolicy: Always
            env:
            - name: AGENT_ENDPOINT
              value: "wss://vs-agent.dev.2060.io:443"
            - name: AGENT_LABEL
              value: hologram-welcome
            - name: AGENT_INVITATION_IMAGE_URL
              value: "https://image.dev.2060.io/invitation.png"
            - name: EVENTS_BASE_URL
              value: "http://chatbot:3003"
            - name: AGENT_PUBLIC_DID
              value: "did:web:vs-agent.dev.2060.io"
            - name: ANONCREDS_SERVICE_BASE_URL
              value: "https://chatbot.dev.2060.io"
            - name: REDIRECT_DEFAULT_URL_TO_INVITATION_URL
              value: "true"
            - name: POSTGRES_HOST
              value: "localhost"
            - name: POSTGRES_USER
              value: "example-db-user"
            - name: POSTGRES_PASSWORD
              value: "example-db-password"
            - name: REDIS_HOST
              value: "localhost"
            ports:
            -  containerPort: 3000
            -  containerPort: 3001
            volumeMounts:
            - name: vs-agent-vsa-pv
              mountPath: /root/.afj

         volumes:
         - name: vs-agent-vsa-pv
           persistentVolumeClaim:
             claimName: vs-agent-vsa-pv
---
# Source: hologram-welcome-ai-agent-chart/templates/chatbot-deployment.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hologram-welcome-ai-agent-chart-chatbot
  namespace: 2060-core-dev
  labels:
    app.kubernetes.io/component: chatbot
    helm.sh/chart: hologram-welcome-ai-agent-chart-1.3.2
    app.kubernetes.io/managed-by: Helm
spec:
  serviceName: hologram-welcome-ai-agent-chart-chatbot
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: chatbot
      app.kubernetes.io/name: hologram-welcome-ai-agent-chart
      app.kubernetes.io/instance: hologram-welcome-dev
  template:
    metadata:
      labels:
        app.kubernetes.io/component: chatbot
        app.kubernetes.io/name: hologram-welcome-ai-agent-chart
        app.kubernetes.io/instance: hologram-welcome-dev
    spec:
      containers:
        - name: chatbot
          image: io2060/hologram-welcome-ai-agent:1.3.2
          imagePullPolicy: Always
          ports:
            - containerPort: 3003
              name: http
          resources:
            limits:
              cpu: 500m
              memory: 512Mi
            requests:
              cpu: 100m
              memory: 128Mi
          env:
            - name: APP_PORT
              value: "3003"
            - name: LOG_LEVEL
              value: "3"
            - name: LLM_PROVIDER
              value: "openai"
            - name: OPENAI_MODEL
              value: "gpt-4"
            - name: VECTOR_STORE
              value: "redis"
            - name: VECTOR_INDEX_NAME
              value: "chat_example_index"
            - name: RAG_PROVIDER
              value: "langchain"
            - name: RAG_DOCS_PATH
              value: "/app/rag/docs"
            - name: AGENT_MEMORY_BACKEND
              value: "redis"
            - name: VS_AGENT_STATS_ENABLED
              value: "true"
            - name: VS_AGENT_STATS_HOST
              value: "activemq-broker.example.svc.cluster.local"
            - name: VS_AGENT_STATS_PORT
              value: "61616"
            - name: VS_AGENT_STATS_QUEUE
              value: "example-agent-queue"
            - name: VS_AGENT_STATS_USER
              value: "example-user"
            - name: VS_AGENT_STATS_PASSWORD
              value: "example-pass"
            - name: AGENT_MEMORY_WINDOW
              value: "30"
            - name: REDIS_URL
              value: "redis://example-redis-host:6379"
            - name: AGENT_PROMPT
              value: "You are the AI assistant for the Example project.\nYour role is to greet users and provide help.\nAlways be polite and concise. Use external tools for stats.\n"
            - name: VS_AGENT_ADMIN_URL
              value: "http://example-vs-agent:3000"
            - name: CREDENTIAL_DEFINITION_ID
              value: "did:web:example.com?service=anoncreds&relativeRef=/credDef/example"
            - name: POSTGRES_HOST
              value: "example-postgres-host"
            - name: LLM_TOOLS_CONFIG
              value: "[{\"name\":\"getExampleData\",\"endpoint\":\"https://example.com/api\",\"method\":\"GET\",\"requiresAuth\":false}]"
            - name: STATISTICS_API_URL
              value: "http://example-stats:8700/stats/view"
            - name: STATISTICS_REQUIRE_AUTH
              value: "true"
            - name: OPENAI_API_KEY
              valueFrom:
                secretKeyRef:
                  name:  chatbot-secret
                  key: OPENAI_API_KEY
            - name: POSTGRES_DB_NAME
              valueFrom:
                secretKeyRef:
                  name:  chatbot-secret
                  key: POSTGRES_DB_NAME
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name:  chatbot-secret
                  key: POSTGRES_PASSWORD
            - name: POSTGRES_USER
              valueFrom:
                secretKeyRef:
                  name:  chatbot-secret
                  key: POSTGRES_USER
          volumeMounts:
            - name: pvc-hologram-welcome-ai-agent-chart-chatbot
              mountPath: /app/rag/docs
  volumeClaimTemplates:
    - metadata:
        name: pvc-hologram-welcome-ai-agent-chart-chatbot
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 1Gi
---
# Source: hologram-welcome-ai-agent-chart/templates/postgres-deployment.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hologram-welcome-ai-agent-chart-postgres
  namespace: 2060-core-dev
  labels:
    app.kubernetes.io/component: postgres
    helm.sh/chart: hologram-welcome-ai-agent-chart-1.3.2
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: postgres
      app.kubernetes.io/name: hologram-welcome-ai-agent-chart
      app.kubernetes.io/instance: hologram-welcome-dev
  template:
    metadata:
      labels:
        app.kubernetes.io/component: postgres
        app.kubernetes.io/name: hologram-welcome-ai-agent-chart
        app.kubernetes.io/instance: hologram-welcome-dev
    spec:
      containers:
        - name: postgres
          image: "postgres:15.2"
          imagePullPolicy: Always
          ports:
            - containerPort: 5432
              name: postgres
          resources:
            limits:
              cpu: 1000m
              memory: 1024Mi
            requests:
              cpu: 200m
              memory: 256Mi
          env:
            - name: PGDATA
              value: "/var/lib/postgresql/data/pgdata"
            - name: POSTGRES_DB
              valueFrom:
                secretKeyRef:
                  name:  postgres-secret
                  key: POSTGRES_DB
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name:  postgres-secret
                  key: POSTGRES_PASSWORD
            - name: POSTGRES_USER
              valueFrom:
                secretKeyRef:
                  name:  postgres-secret
                  key: POSTGRES_USER
          volumeMounts:
            - name: pvc-hologram-welcome-ai-agent-chart-postgres
              mountPath: /var/lib/postgresql/data
  volumeClaimTemplates:
    - metadata:
        name: pvc-hologram-welcome-ai-agent-chart-postgres
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
---
# Source: hologram-welcome-ai-agent-chart/templates/redis-deployment.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hologram-welcome-ai-agent-chart-redis
  namespace: 2060-core-dev
  labels:
    app.kubernetes.io/component: redis
    helm.sh/chart: hologram-welcome-ai-agent-chart-1.3.2
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redis
      app.kubernetes.io/name: hologram-welcome-ai-agent-chart
      app.kubernetes.io/instance: hologram-welcome-dev
  template:
    metadata:
      labels:
        app.kubernetes.io/component: redis
        app.kubernetes.io/name: hologram-welcome-ai-agent-chart
        app.kubernetes.io/instance: hologram-welcome-dev
    spec:
      containers:
        - name: redis
          image: "redis/redis-stack-server:7.2.0-v17"
          imagePullPolicy: Always
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 50m
              memory: 64Mi  
          ports:
            - containerPort: 6379
          volumeMounts:
            - name: redis-data
              mountPath: /data
  volumeClaimTemplates:
    - metadata:
        name: redis-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 1Gi
---
# Source: hologram-welcome-ai-agent-chart/templates/stats-deployment.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hologram-welcome-ai-agent-chart-stats
  namespace: 2060-core-dev
  labels:
    app.kubernetes.io/component: stats
    
    helm.sh/chart: hologram-welcome-ai-agent-chart-1.3.2
    app.kubernetes.io/managed-by: Helm
spec:
  serviceName: hologram-welcome-ai-agent-chart-stats
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: stats
      app.kubernetes.io/name: hologram-welcome-ai-agent-chart
      app.kubernetes.io/instance: hologram-welcome-dev
  template:
    metadata:
      labels:
        app.kubernetes.io/component: stats
        app.kubernetes.io/name: hologram-welcome-ai-agent-chart
        app.kubernetes.io/instance: hologram-welcome-dev
    spec:
      containers:
        - name: stats-container
          image: mobiera/stats:v1.1.5
          imagePullPolicy: Always
          ports:
            - name: http
              containerPort: 8700
          resources:
            null
          env:
            - name: DEBUG
              value: "3"
            - name: QUARKUS_HTTP_PORT
              value: "8700"
            - name: COM_MOBIERA_MS_COMMONS_STATS_JMS_QUEUE_NAME
              value: "example-agent-queue"
            - name: COM_MOBIERA_MS_COMMONS_STATS_THREADS
              value: "1"
            - name: COM_MOBIERA_MS_COMMONS_STATS_STANDALONE
              value: "1"
            - name: QUARKUS_ARTEMIS_A0_URL
              value: "tcp://example-artemis.namespace.svc.cluster.local:61616"
            - name: QUARKUS_ARTEMIS_A0_USERNAME
              value: "example-user"
            - name: QUARKUS_DATASOURCE_JDBC_URL
              value: "jdbc:postgresql://example-postgres.namespace/db"
            - name: QUARKUS_DATASOURCE_USERNAME
              value: "example-db-user"
            - name: QUARKUS_ARTEMIS_A0_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: stats-secret
                  key: QUARKUS_ARTEMIS_A0_PASSWORD
            - name: QUARKUS_DATASOURCE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: stats-secret
                  key: QUARKUS_DATASOURCE_PASSWORD
---
# Source: hologram-welcome-ai-agent-chart/charts/vs-agent-chart/templates/deployment.yaml
# Ingress resource for the VS Agent
# This resource defines how external traffic can access the VS Agent service
# It routes traffic to the agent service and provides TLS termination
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: public-vs-agent
  namespace: 2060-core-dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/enable-cors: "true"
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - vs-agent.dev.2060.io
      secretName: public.vs-agent.dev.2060.io-cert
  rules:
    - host: vs-agent.dev.2060.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                 name: vs-agent
                 port:
                   number: 3001
---
# Source: hologram-welcome-ai-agent-chart/templates/chatbot-deployment.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: hologram-welcome-ai-agent-chart-chatbot
  namespace: 2060-core-dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - hw-c.dev.2060.io
      secretName: hw-c.dev.2060.io-cert
  rules:
    - host: hw-c.dev.2060.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: hologram-welcome-ai-agent-chart-chatbot
                port:
                  number: 3003
---
# Source: hologram-welcome-ai-agent-chart/templates/stats-deployment.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: hologram-welcome-ai-agent-chart-stats
  namespace: 2060-core-dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - example-stats.dev.2060.io
      secretName: example-stats.dev.2060.io-cert
  rules:
    - host: example-stats.dev.2060.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: hologram-welcome-ai-agent-chart-stats
                port:
                  number: 8700
---
# Source: hologram-welcome-ai-agent-chart/charts/vs-agent-chart/templates/deployment.yaml
# PersistentVolumeClaim for the PostgreSQL database
# This PVC is used to store the PostgreSQL data
# If the database is enabled, this PVC will be created
---
# Source: hologram-welcome-ai-agent-chart/charts/vs-agent-chart/templates/deployment.yaml
# PersistentVolumeClaim for the Redis database
# This PVC is used to store the Redis data
# If Redis is enabled, this PVC will be created
